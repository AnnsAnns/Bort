<!DOCTYPE html><script type="module" src="/_astro/BaseLayout.astro_astro_type_script_index_0_lang.Bn0F6yBh.js"></script> <html lang="en" class="standard" data-astro-transition-persist="astro-djjcnqsn-1"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v4.5.2"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://annsann.eu/blog/rust_microcontrollers/"><!-- Primary Meta Tags --><title>AnnsAnn üê∏   - Rust, Risc-V and embedded systems</title><meta name="title" content="AnnsAnn üê∏   - Rust, Risc-V and embedded systems"><meta name="description" content="First Steps: The Sipeed Longan Nano Risc-V microcontroller and Rust"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://annsann.eu/blog/rust_microcontrollers/"><meta property="og:title" content="AnnsAnn üê∏   - Rust, Risc-V and embedded systems"><meta property="og:description" content="First Steps: The Sipeed Longan Nano Risc-V microcontroller and Rust"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://annsann.eu/blog/rust_microcontrollers/"><meta property="twitter:title" content="AnnsAnn üê∏   - Rust, Risc-V and embedded systems"><meta property="twitter:description" content="First Steps: The Sipeed Longan Nano Risc-V microcontroller and Rust"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ViewTransitions.astro_astro_type_script_index_0_lang.D9HCc-z0.js"></script><link rel="stylesheet" href="/_astro/_slug_.ThBPYpTY.css" /><script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js');
}</script><style>[data-astro-transition-scope="astro-fvq7hoki-3"] { view-transition-name: astro-fvq7hoki-3; }@layer astro { ::view-transition-old(astro-fvq7hoki-3) { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }::view-transition-new(astro-fvq7hoki-3) { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back]::view-transition-old(astro-fvq7hoki-3) { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back]::view-transition-new(astro-fvq7hoki-3) { 
	animation-name: astroFadeIn, astroSlideFromLeft; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-fvq7hoki-3"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-fvq7hoki-3"] { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-fvq7hoki-3"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-fvq7hoki-3"] { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-fvq7hoki-3"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-fvq7hoki-3"] { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-fvq7hoki-3"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-fvq7hoki-3"] { 
	animation-name: astroFadeIn, astroSlideFromLeft; }</style></head> <body> <div class="h-full sm:h-screen w-full bg-base-bd-background-color md:overflow-clip"> <div class="md:grid md:grid-cols-4 lg:grid-cols-4 md:gap-8 p-4 justify-center h-full w-full sm:h-screen">  <div class="flex justify-self-end gap-y-6 lg:gap-y-16 lg:py-20 py-4 flex-col w-full md:w-min h-full md:h-screen sm:justify-evenly lg:justify-start"> <div class="font-headerf w-full md:w-44 lg:w-60 text-lg"> <div class="
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
 "> <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
    ">
‚ûñ‚èπÔ∏è‚ùå
</div> <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    "> <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        ">  </div> <div>  <div class="flex flex-col min-h-fit min-w-[120px] pt-3"> <a href="/"> <div class="flex flex-col trans justify-center self-center text-center font-semibold items-center"> <img src="/_astro/CharacterTransparent.DHggqFHF_Z22MWyu.webp" alt="logo" class="justify-self-center bg-base-text-color/25 p-2 py-1 w-28 shadow-xl rounded-3xl bg-cover" width="112" height="112" loading="lazy" decoding="async"> <div class="text-xl font-bodyf font-bold">
AnnsAnn
</div> </div> </a> <hr class="h-[2px] my-2 bg-gray-200 border-0 "> <a class="navitem hover:bg-base-text-color/30 active:bg-base-text-color/60" href="/">
Home
</a> <a class="navitem hover:bg-base-text-color/30 active:bg-base-text-color/60" href="/blog">
Blog
</a> <!-- <a class="navitem hover:bg-base-text-color/30 active:bg-base-text-color/60" href="/about">
                About
            </a> --> <a class="navitem hover:bg-base-text-color/30 active:bg-base-text-color/60" href="/friends">
Friends
</a> <a class="navitem hover:bg-base-text-color/30 active:bg-base-text-color/60" href="https://github.com/AnnsAnns">
Github
</a> </div>  </div> </div> </div> </div> <div class=""> <script type="module" src="/_astro/Themes.astro_astro_type_script_index_0_lang.aDLsSDSU.js"></script> <div class="
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
 "> <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
    ">
‚ûñ‚èπÔ∏è‚ùå
</div> <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    "> <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        ">  </div> <div>  <div class="content-center p-3 text-center"> <button id="themeSwitcherClick" class="
            font-headerf
            text-lg
            md:text-xl
            lg:text-2xl
            bg-base-text-color/25
            rounded-lg
            p-3
        ">
Change Theme
</button> <div class="theme-name font-light text-base-text-color/40 mb-[-12px]">
LOADING ...
</div> </div>  </div> </div> </div> </div> </div>  <div class="md:col-span-3 justify-center lg:col-span-2 h-full sm:h-screen w-full sm:max-h-screen sm:max-w-full" data-astro-transition-scope="astro-fvq7hoki-3">  <div class="h-full w-full flex flex-col items-center"> <div class="
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
 w-full md:w-fit"> <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
    ">
‚ûñ‚èπÔ∏è‚ùå
</div> <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    "> <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        "> Rust, Risc-V and embedded systems </div> <div>  <article> <div class="flex flex-row justify-between"> <div class="description text-base-text-color/80 font-medium text-lg"> <p>First Steps: The Sipeed Longan Nano Risc-V microcontroller and Rust</p> </div> <div class="date text-base-text-color/60"> <time datetime="2021-02-11T00:00:00.000Z"> Feb 11, 2021 </time>  </div> </div> <div class="hero-image">  </div> <br> <hr> <br> <div class="legacy-warning"> <h1 class="text-slate-500 text-xl font-bold">
This is a legacy blog post from a long time ago.<br>
It might contain outdated or incorrect information.
</h1> <br> </div> <div class="prose"> <div class="
				prose-zinc
                prose-lg
                prose-a:text-base-text-color
                prose-headings:text-base-text-color
                prose-headings:font-headerf
                font-medium
                text-base-text-color
                font-bodyf
                leading-snug
                prose-img:max-h-96
                prose-img:w-auto
                prose-img:text-center
                prose-blockquote:bg-base-text-color/10
                prose-a:text-base-text-color/90
				prose-strong:text-base-text-color
                prose-a:underline
				prose-code:bg-base-text-color/10
				prose-code:text-base-text-color
				">  <p>Recently I bought a Risc-V development board, the Sipeed Longan Nano to be exact. Risc-V has always been something I just wanted to work on sooner or later, it‚Äôs one of the few CPU architectures that fascinate me and I strongly believe that sooner or later it‚Äôll run most of our devices. The open source and modular nature of it makes it a wonderful contender for IoT and anything that needs to be fast, cheap and small.</p>
<img src="/_astro/compare.BlmtqtGs_1zhBP6.webp" alt="The Longan Nano, Raspberry Pi Pico and a pen for scale." width="3968" height="2976" loading="lazy" decoding="async">
<p>The Longan Nano in itself is actually quite amazing for the price. It offers 128 KB of Flash, 32 KB of SRAM and a lot of different peripherals while running at a <em>blazing fast</em> 32.768KHz [Low Spec Mode] and 8MHz at it‚Äôs highest speed ;) Yes, those specs aren‚Äôt that impressive compared to the Pico given that both share the same pricetag but the Longan Nano also comes with a MicroSD reader, USB-C and a 160x80 IPS RGB LCD which I‚Äôd call quite the package for it‚Äôs price of only 5‚Ç¨.</p>
<p>Now, naturally one would assume that you‚Äôd have to use good old C/C++ with it and you‚Äôd probably be right in 9 out of 10 cases but I thought that was boring and really wanted to use the most hyped language of them all, Rust. I mostly blame <a href="https://github.com/shadowninja108">Shadow</a> for his work on skyline, <a href="https://github.com/EliseZeroTwo">Elise</a> for her WARS-8 project and <a href="https://github.com/jam1garner">Jam1garner</a> for his really amazing and detailed blog posts that strongly inspired me (If you‚Äôre reading this, thank you for inspiring me even though you probably never talked to me before).
Sooner or later I really want to write a blogpost about Rust itself but I feel like I‚Äôm not too comfortable with the language yet to share my knowledge with random internet strangers.</p>
<p>Anyways, 1 + 1 = 2 and so I decided to try to use Rust for the microcontroller which at first seemed surprisingly easy but as everything in the low-level development world, it ofc had thousands of small problems that lurked behind the corner to destroy you once you tried it. Given that I want people to not fall into the same pitfalls, this simple and short blog post should hopefully solve most common problems when trying this (and might arouse interest for some, idk).</p>
<h3 id="my-setup">My Setup</h3>
<p>Before writing about many of the problems, I gotta admit something. My setup is really really cursed when it comes to such stuff.
I‚Äôm currently running Windows 10 Pro on my main machine with 99.9% of all development related stuff running inside a WSL2 Arch instance. For those that are familiar with the Windows Subsystem for Linux stuff, Arch actually isn‚Äôt one of the officially supported systems for it. My Arch WSL only exists and works because of the amazing work and dedication by Arch fans. If you also dedicate your existence to sharing the word of our lord and saviour Arch, I‚Äôd recommend this: <a href="https://github.com/yuk7/ArchWSL">https://github.com/yuk7/ArchWSL</a></p>
<img src="/_astro/meme.BAQueRs__Z2pFlUp.webp" alt="btw I use arch meme" width="801" height="803" loading="lazy" decoding="async">
<p>It honestly works really well and after having Arch as my main OS for quite some time, I really can‚Äôt live without the AUR and rolling releases. So far I haven‚Äôt experienced any major issues (With some exceptions for WSL scripts that were meant for debian based systems).</p>
<h3 id="broken-drivers">Broken drivers</h3>
<p>For some unknown reason my Longan Nano shipped with really broken drivers and Windows 10 had extreme issues installing any drivers for it. Normally it should just easily go into the flashing mode through a button combination and then appear in Zadig to simply install the WinUSB (or similar) driver.
In my case Zadig broke completely and I had to do it manually. At first this annoyed and confused me but thanks to the <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/winusb-installation">Microsoft WinUSB installation guide</a> and <a href="https://ribesjordi.wordpress.com/2020/04/10/setting-up-the-pio-ide-for-sipeed-longan-nano-in-windows-10/">another developer</a> that had the same issue, I was able to fix it quite painlessly.</p>
<h3 id="the-longan-nano-rust-crate">The Longan Nano Rust Crate</h3>
<p>Luckily, there is a well done and ready to use rust crate for my device already, you can find it here: <a href="https://github.com/riscv-rust/longan-nano">https://github.com/riscv-rust/longan-nano</a></p>
<p>The Getting Started part wasn‚Äôt actually that hard aside from the fact that you had to basically install forks of every single thing because Risc-V related stuff isn‚Äôt streamlined in most projects yet.
Once again, I gotta thank the AUR for saving my from a lot of hassle by simply providing easily installable packages of most of these forks. Sadly the openocd package appeared to be broken for now because of some dependency issue but luckily there are three different ways to flash and use the rust crate so I could just switch to dfu-util.</p>
<h3 id="wsl-and-microcontrollers-dont-pair-well">WSL and microcontrollers don‚Äôt pair well</h3>
<p>WSL is awesome but it sucks when it comes to physical devices. Given the nature of a subsystem, I sadly couldn‚Äôt flash the microcontroller from my Arch instance and had to install dfu-util on my Windows machine to flash the device. Luckily the filesystem integration in WSL2 is so well done that I could simple open a powershell inside my WSL2 files and use my Windows tools on them. Glory to the monopoly of Microsoft I guess. All in all this was more of a minor hindrance that can easily be fixed with a custom buildscript.</p>
<h3 id="building-the-examples">Building the examples</h3>
<p>At first this seemed easy, there is one minor error in the documentation in which it tried to link to a wrong directory but that was quite easy to spot and fix. After a bit of tinkering I had a flashable file that I could just throw onto the Longan Nano and be happy with and that‚Äôs what I did. The blinking example worked and so I moved on.</p>
<h3 id="the-present">The Present</h3>
<p>As I said at the start of this blogpost, this blog post isn‚Äôt as detailed as I originally expected my second blog post to be in order to be more consistent and actually have some form of content on my site. For now I‚Äôm still working on my own project with the library and have made some, even if little, progress with it over a few hours of testing. My aim is to get something more impressive to work for the next blogpost so I can explain most of peripherals the Longan Nano has.</p>
<p>The endgoal is to get Rust running on the Raspberry Pi Pico but for now I thank everyone that read this blogpost till this point and hope to see you in the next part of this series. ~~~Lets just hope that I‚Äôm motivated enough to write the next one~~~</p>  </div> </div> </article>  </div> </div> </div> </div>  </div>  <div class="w-full max-sm:mt-4 md:w-fit flex flex-col-reverse h-full md:h-screen 4k:justify-center sm:justify-start gap-y-4"> <div class="w-full"> <div class="justify-items-center xl:max-w-64 grid grid-flow-row auto-rows-max gap-4 justify-between items-center h-full md:m-8"> <div class="w-full"> <div class="
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
 "> <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
    ">
‚ûñ‚èπÔ∏è‚ùå
</div> <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    "> <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        ">  </div> <div>  <div class="flex flex-col justify-center items-center pt-6"> <audio controls loop autoplay data-astro-transition-persist="astro-gqvfa26k-5"> <source src="/CheckMiiOut.mp3" type="audio/mpeg"> </audio> </div>  </div> </div> </div> </div> <div class="
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
 "> <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
    ">
‚ûñ‚èπÔ∏è‚ùå
</div> <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    "> <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        ">  </div> <div>  <div class="content-center items-center justify-center justify-items-center grid h-full pt-4 gap-1"> <a href="https://www.youtube.com/watch?v=1U9ls3vAt5I"> <img src="/_astro/jerma.Dvz9-M6x_5BL3K.webp" alt="Jerma Blinky" width="150" height="20" loading="lazy" decoding="async"> </a> <a href="https://www.youtube.com/watch?v=PLaanhBuiVU"> <img src="/_astro/da%20blinkie.D8zGGJVl_2ltmlK.webp" alt="Da Blinki?!?" width="150" height="20" loading="lazy" decoding="async"> </a> <a href="https://archlinux.org/"> <img src="/_astro/trans.Z-HUyix4_1dU0U4.webp" alt="Trans Rights" width="150" height="20" loading="lazy" decoding="async"> </a> <a href="https://www.youtube.com/watch?v=iBF_mDFgtH4"> <img src="/_astro/mikujerma.B4X_zxFm_28UkeB.webp" alt="Miku Jerma" width="150" height="20" loading="lazy" decoding="async"> </a> <a href="https://www.youtube.com/watch?v=0Qs_jRerdSg"> <img src="/_astro/jermamiku.5QlUaEGj_D8EjV.webp" alt="Jerma Miku" width="150" height="20" loading="lazy" decoding="async"> </a> <div class="w-full columns-2"> <a href="https://www.youtube.com/watch?v=yD2FSwTy2lw"> <img src="/_astro/bob.DeuMGCJO_Zkjcg8.webp" alt="Bob from Animal Crossing spinning" width="88" height="31" loading="lazy" decoding="async"> </a> <a href="https://www.mozilla.org/en-US/firefox/windows/"> <img src="/_astro/fftake.juBJ8bzE_eLaK.webp" alt="Download Firefox" width="88" height="31" loading="lazy" decoding="async"> </a> </div> </div>  </div> </div> </div> </div> </div> </div> </div> </div>
../utils/themes.ts</body></html>