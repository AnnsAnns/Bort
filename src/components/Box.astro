---

interface Props {
    title: string;
    className?: string;
    shareSlug?: string;
    createRandomness?: boolean;
}

let { title, className, shareSlug, createRandomness } = Astro.props;

createRandomness = false; // Temporarily disable randomness till I decide whether to keep it or not

const randomRotation = createRandomness ? Math.floor(Math.random() * 2) : 0;
const is_negative = createRandomness ? Math.random() < 0.5 : false;

let additionalClasses = className ?? '';
const baseClasses = `
    bg-base-background-color
    ring-box-color-standard
    ring-4
    break-words
    overflow-hidden
    shadow-square
    shadow-box-color-standard/50
    min-h-[120px]
    min-w-[120px]
    flex flex-col
    ${is_negative ? '-rotate-' : 'rotate-'}${randomRotation}
    m-1
    px-3
    pb-3
    sm:max-h-notfullscreen
    text-base-text-color
    rounded-sm
    relative
`;

const classes = `${baseClasses} ${additionalClasses}`;

---

<div class={classes} data-draggable-box>
    <div class="
        bg-box-color-standard
        mx-[-12px]
        min-w-max
        min-h-min
        items-end
        text-left
        text-end
        flex
        justify-end
        align-middle
        p-1
        pb-2
        gap-1
        text-base-background-color
        cursor-move
    " data-drag-handle>
    {
        shareSlug && (
            <a id="SHAREBUTTON" href={`#${shareSlug}`}>
                üîó Share Link
            </a>
        )
    }
        ‚ûñ ‚èπÔ∏è ‚ùå
    </div>
    <div class="
        sm:overflow-y-auto
        scrollbar-thin
        scrollbar-track-base-background-color
        scrollbar-thumb-box-color-standard
    ">
        <div class="
            font-headerf
            text-2xl
            md:text-3xl
            lg:text-4xl
        ">
            {title}
        </div>
        <div>
            <slot />
        </div>
    </div>
</div>

<!-- <script>
    const initDraggable = () => {
        // Only enable dragging on xl screens and above (1280px+)
        if (window.innerWidth < 1280) return;

        document.querySelectorAll('[data-draggable-box]').forEach((box: HTMLElement) => {
            const handle = box.querySelector('[data-drag-handle]');
            let isDragging = false;
            let currentX = 0;
            let currentY = 0;
            let initialX = 0;
            let initialY = 0;
            let placeholder: HTMLElement | null = null;

            handle?.addEventListener('mousedown', (e) => {
                if ((e.target as HTMLElement).closest('a')) return;
                isDragging = true;
                const rect = box.getBoundingClientRect();
                initialX = e.clientX - rect.left;
                initialY = e.clientY - rect.top;
                currentX = rect.left;
                currentY = rect.top;
                
                // Create placeholder
                if (box.style.position !== "fixed") {
                    placeholder = document.createElement('div');
                    placeholder.style.width = `${rect.width}px`;
                    placeholder.style.height = `${rect.height}px`;
                    placeholder.style.visibility = 'hidden';
                    box.parentNode?.insertBefore(placeholder, box);
                }

                box.style.position = 'fixed';
                box.style.left = `${currentX}px`;
                box.style.top = `${currentY}px`;
                box.style.margin = '0';
                box.style.width = `${rect.width}px`;
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                (box as HTMLElement).style.left = `${currentX}px`;
                (box as HTMLElement).style.top = `${currentY}px`;
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        });
    };

    // Initialize on load
    initDraggable();

    // Re-initialize on resize if crossing the xl breakpoint
    window.addEventListener('resize', initDraggable);
</script> -->